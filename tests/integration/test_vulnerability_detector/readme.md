# Tests vulnerability detector

Wazuh is able to detect vulnerabilities in the applications installed in agents using the `Vulnerability Detector` module. This software audit is performed through the integration of vulnerability feeds indexed by `Canonical`, `Debian`, `RedHat`, and the `National Vulnerability Database`.

This directory includes all the integration tests developed to test the correct functioning of this module.

These tests can be classified in these categories:

- **[test_feeds](test_feeds)**: Tests that check the behavior of Vulnerability Detector when a feed with an unexpected content/type is imported, feeds downloads...

- **[test_general_settings](test_general_settings)**: Tests that check basic configuration of the Vulnerability Detector in the `ossec.conf`.

- **[test_providers](test_providers)**: Tests that check the providers configuration in the `ossec.conf`.

- **[test_scan_results](test_scan_results)** Tests that check if Vulnerability Detector generates alerts in the right cases.

We can specify the set of tests that we want to launch, either individually, module, package or custom. Normally,
the tests are selected in a personalized way called **tier**.

A `tier` is a grouping of tests that follows some logic. Normally this logic is as follows:

- *tier 0* : Tests that test basic functionality and are of short duration
- *tier 1* : Test that tests the main functionalities and is of medium duration
- *tier 2* : Tests that test specific functionalities in detail They are usually of long duration
- *...*

The following section shows the classification of tests in the different tiers.

## Tiers

### Tier 0

#### Test general settings

- **[test_general_settings_enabled](./doc/test_general_settings/test_general_settings_enabled.md)** Tests that modify the value of `enabled` tag in `ossec.conf` and check the result in `ossec.log`.

- **[test_general_settings_ignore_time](./doc/test_general_settings/test_general_settings_ignore_time.md)**: Tests that modify the value of `ignore_time` tag in `ossec.conf`, set different times and check the result in `ossec.log`.

- **[test_general_settings_interval](./doc/test_general_settings/test_general_settings_interval.md)**: Tests that modify the value of `interval` tag in `ossec.conf`, set different times and check the result in `ossec.log`.

- **[test_general_settings_run_on_start](./doc/test_general_settings/test_general_settings_run_on_start.md)**: Tests
that modify the value of `run_on_start` tag in `ossec.conf` and check the result in `ossec.log`.

#### Test scan results

- **[test_debian_inventory_debian_feed](./doc/test_scan_results/test_debian_inventory_debian_feed.md)**: Tests that mock Debian systems and insert custom vulnerabilities and vulnerable packages to check if Vulnerability Detector generates the alerts from Debian provider feed.

- **[test_redhat_inventory_redhat_feed](./doc/test_scan_results/test_redhat_inventory_redhat_feed.md)**: Tests that mock RedHat systems and insert custom vulnerabilities and vulnerable packages to check if Vulnerability Detector generates the alerts from RedHat provider feed.

- **[test_ubuntu_inventory_canonical_feed](./doc/test_scan_results/test_ubuntu_inventory_canonical_feed.md)**:  Tests that mock Ubuntu systems and insert custom vulnerabilities and vulnerable packages to check if Vulnerability Detector generates the alerts from Canonical provider feed.

- **[test_scan_nvd_feed](./doc/test_scan_results/test_scan_nvd_feed.md)**: Tests that mock RedHat, Ubuntu, Debian, and Windows systems, and insert custom vulnerabilities and vulnerable packages to check if Vulnerability Detector generates the alerts from NVD feed.

- **[test_scan_providers_and_nvd_feed](./doc/test_scan_results/test_scan_providers_and_nvd_feed.md)**: Tests mock RedHat, Ubuntu and Debian systems, and insert custom vulnerabilities and vulnerable packages to see if Vulnerability Detector generates the alerts from NVD and providers feed.

---

### Tier 1

#### Test feeds

- **[test_download_feeds](./doc/test_feeds/generic/test_download_feeds.md)**: The tests download the different feeds (Redhat, Canonical, Debian, and NVD), import them, and check if the confirmation message appears in the logs.

#### Test providers

- **[test_providers_enabled](./doc/test_providers/test_providers_enabled.md)**: Tests that modify the value of `enabled` tag in `ossec.conf` and check the result in `ossec.log`.

- **[test_providers_os](./doc/test_providers/test_providers_os.md)**: Tests that modify the value of `os` tag in `ossec.conf`, set different `os` for Canonical and Debian, and check the result in `ossec.log`.

- **[test_providers_update_from_year](./doc/test_providers/test_providers_update_from_year.md)**: Tests modify the value of `update_from_year` tag in `ossec.conf`, set different years and check the result in `ossec.log`.

- **[test_providers_update_interval](./doc/test_providers/test_providers_update_interval.md)**: Teststhat modify the value of `interval` tag in `ossec.conf`, set different time intervals and units, and check the result in `ossec.log`.

---

### Tier 2

#### Test feeds - GENERIC

- **[test_invalid_type_custom_feeds](./doc/test_feeds/generic/test_invalid_type_custom_feeds.md)**: Tests that  import files of several different types (`.mp3`, `.jpg`, `.pdf` ...) as custom feed, and check the response of Vulnerability Detector.

- **[test_validate_feed_content](./doc/test_feeds/generic/test_validate_feed_content.md)**: Tests that download the feeds of all providers, verify the format of each feed is as expected and their content is also `XML` or `JSON` parseable.

#### Test feeds - RHEL

- **[test_extra_fields_redhat_feed](./doc/test_feeds/redhat/test_extra_fields_redhat_feed.md)**: Set of tests that check the behavior of vulnerability detector when there is any extra field in the feed.

- **[test_invalid_syntax_redhat_feed](./doc/test_feeds/redhat/test_invalid_syntax_redhat_feed.md)**: Set of tests that check the behavior of Vulnerability Detector when the feed has some kind of syntactic error.

- **[test_invalid_values_redhat_feed](./doc/test_feeds/redhat/test_invalid_values_redhat_feed.md)**: Set of tests that check the behavior of Vulnerability Detector when the value of a field is incorrect.

- **[test_missing_fields_redhat_feed](./doc/test_feeds/redhat/test_missing_fields_redhat_feed.md)**: Set of tests that check the behavior of Vulnerability Detector when any field is missing from the feed.

#### Test feeds - CANONICAL

- **[test_extra_tags_canonical_feed](./doc/test_feeds/canonical/test_extra_tags_canonical_feed.md)**: Set of tests
that check the behavior of Vulnerability Detector when there is any extra tag in the feed.

- **[test_invalid_syntax_canonical_feed](./doc/test_feeds/canonical/test_invalid_syntax_canonical_feed.md)**: Set of
tests that check the behavior of Vulnerability Detector when the feed has some kind of syntactic error.

- **[test_invalid_values_canonical_feed](./doc/test_feeds/canonical/test_invalid_values_canonical_feed.md)**: Set of
tests that check the behavior of Vulnerability Detector when the value of a tag is incorrect.

- **[test_missing_tags_canonical_feed](./doc/test_feeds/canonical/test_missing_tags_canonical_feed.md)**: Set of tests that check the behavior of Vulnerability Detector when any tag is missing from the feed.

#### Test feeds - DEBIAN

- **[test_extra_tags_debian_feed](./doc/test_feeds/debian/test_extra_tags_debian_feed.md)**: Set of tests that check the behavior of Vulnerability Detector when there is any extra tag in the feed.

- **[test_invalid_syntax_debian_feed](./doc/test_feeds/debian/test_invalid_syntax_debian_feed.md)**: Set of tests check the behavior of Vulnerability Detector when the feed has some kind of syntactic error.

- **[test_invalid_values_debian_feed](./doc/test_feeds/debian/test_invalid_values_debian_feed.md)**: Set of tests that check the behavior of vulnerability detector when the value of a tag is not correct.

- **[test_missing_tags_debian_feed](./doc/test_feeds/debian/test_missing_tags_debian_feed.md)**: Set of tests that check the behavior of Vulnerability Detector when any tag is missing from the feed.
